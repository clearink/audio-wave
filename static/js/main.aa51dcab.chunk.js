(this.webpackJsonpcloudmusic=this.webpackJsonpcloudmusic||[]).push([[0],{158:function(t,e,i){},163:function(t,e,i){"use strict";i.r(e);var n=i(0),r=i.n(n),a=i(11),s=i.n(a),c=i(85),o=(i(92),i(56)),u=(i(94),i(18)),h=i(24),l=i.n(h),f=i(34),v=(i(97),i(84)),p=i(35),d=i(79),m=i.n(d);function y(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var b=function(t){var e=t.method,i=void 0===e?"get":e;return new Promise((function(e){m()(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?y(i,!0).forEach((function(e){Object(p.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):y(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t,{method:i,timeout:5e3})).then((function(t){200===t.status&&e(t)})).catch((function(t){v.a.error("\u8bf7\u6c42\u5931\u8d25")}))}))},g=function(){var t=Object(f.a)(l.a.mark((function t(e){var i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b({url:e,responseType:"arraybuffer"});case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),C=i(55),w=i(82);function x(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var O="paused",j=function(){function t(e){Object(C.a)(this,t),this.buffer=null,this.act=new AudioContext,this.sourceNode=null,this.state=O,this.lastPlayTime=0,this.startTime=0,this.peaks=[],this.container=null,this.cover=null,this.lineCtx=null,this.coverCtx=null,this.gain=1,this.options={waveColor:"#555",coverColor:"#37A2DF"},this.regions=[],this.animationID=null,this.options=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?x(i,!0).forEach((function(e){Object(p.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):x(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},this.options,{},e),this.container=e.container,this.lineCtx=e.lineCtx,this.coverCtx=e.coverCtx,this.cover=e.cover,this.regions=e.regions}return Object(w.a)(t,[{key:"setCanvasOptions",value:function(){var t=Math.max(30*this.buffer.duration,this.container.clientWidth);this.lineCtx.canvas.style.width=t+"px",this.lineCtx.canvas.width=t,this.lineCtx.fillStyle=this.options.waveColor,this.coverCtx.canvas.style.width=t+"px",this.coverCtx.canvas.width=t,this.coverCtx.fillStyle=this.options.coverColor}},{key:"load",value:function(){var t=Object(f.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.act.decodeAudioData(e);case 2:this.buffer=t.sent,this.reload(),this.setCanvasOptions(),this.getPeaks(),this.drawWave();case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"reload",value:function(){this.cover.style.width="0px",this.pause(),this.startTime=0}},{key:"getPeaks",value:function(){for(var t=[],e=~~(this.buffer.length/this.lineCtx.canvas.width),i=this.buffer.getChannelData(0),n=i.length,r=0;r*e<n;r++){for(var a=0,s=0,c=r*e,o=c+e,u=c;u<o&&u<n;u++){var h=i[u];a<h&&(a=h),s>h&&(s=h)}t.push(a,s)}this.peaks=t}},{key:"drawWave",value:function(){var t=this.lineCtx.canvas,e=this.peaks.length,i=t.width/e;this.lineCtx.beginPath(),this.coverCtx.beginPath(),this.lineCtx.fillRect(0,t.height/2,t.width,1),this.coverCtx.fillRect(0,t.height/2,t.width,1);for(var n=0;n<e;n+=2){var r=(1-this.peaks[n]*this.gain)*t.height/2;this.lineCtx.lineTo(n*i,r),this.coverCtx.lineTo(n*i,r)}for(var a=e-1;a>=0;a-=2){var s=(1-this.peaks[a]*this.gain)*t.height/2;this.lineCtx.lineTo(a*i,s),this.coverCtx.lineTo(a*i,s)}this.lineCtx.fill(),this.coverCtx.fill()}},{key:"clearWave",value:function(){var t=this.lineCtx.canvas;this.lineCtx.clearRect(0,0,t.width,t.height),this.coverCtx.clearRect(0,0,t.width,t.height)}},{key:"resize",value:function(){this.buffer&&(this.setCanvasOptions(),this.getPeaks(),this.clearWave(),this.drawWave(),this.cover.style.width=this.getCurrentTime()*this.lineCtx.canvas.width/this.buffer.duration+"px")}},{key:"resizeCover",value:function(t){if(this.buffer){var e=t/this.lineCtx.canvas.width*this.buffer.duration;this.cover.style.width=(0|t)+"px",this.startTime=e,"playing"===this.state?(this.state=O,this.play()):(this.state=O,this.createSourceNode())}}},{key:"animation",value:function(){var t=Math.round(this.getCurrentTime()/this.buffer.duration*this.lineCtx.canvas.width);this.cover.style.width=t+"px",t<this.lineCtx.canvas.width?this.animationID=requestAnimationFrame(this.animation.bind(this)):this.finished()}},{key:"createSourceNode",value:function(){this.sourceNode&&this.sourceNode.disconnect(),this.sourceNode=this.act.createBufferSource(),this.sourceNode.buffer=this.buffer,this.sourceNode.connect(this.act.destination)}},{key:"play",value:function(){this.buffer&&"playing"!==this.state&&(this.createSourceNode(),this.state="playing",this.lastPlayTime=this.act.currentTime,this.sourceNode.start(0,this.getCurrentTime()),cancelAnimationFrame(this.animationID),this.animationID=requestAnimationFrame(this.animation.bind(this)))}},{key:"pause",value:function(){try{this.sourceNode.stop(0)}catch(t){}this.startTime=this.getCurrentTime(),this.state=O,cancelAnimationFrame(this.animationID)}},{key:"finished",value:function(){this.cover.style.width=this.lineCtx.canvas.width+"px",this.state="finished",this.startTime=0}},{key:"getCurrentTime",value:function(){switch(this.state){case"playing":return this.startTime+this.act.currentTime-this.lastPlayTime;case O:return this.startTime;case"finished":return this.buffer.duration;default:return 0}}}]),t}();i(158);var k=function(t){var e=Object(n.useRef)(null),i=Object(n.useRef)(null),a=Object(n.useRef)(null),s=Object(n.useRef)(null),c=Object(n.useRef)(null);return Object(n.useEffect)((function(){var t=c.current.getContext("2d"),n=s.current.getContext("2d");e.current=new j({container:i.current,cover:a.current,coverCtx:n,lineCtx:t,regions:[]});var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=null;return function(){for(var n=this,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];i||(i=setTimeout((function(){t.apply(n,a),i=null}),e))}}((function(){e.current.resize()}));return window.addEventListener("resize",r),function(){window.removeEventListener("resize",r)}}),[]),Object(n.useEffect)((function(){t.src?g(t.src).then((function(t){e.current.load(t)})):t.data&&e.current.load(t.data).then((function(){}))}),[t.src,t.data]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"wrap",ref:i,onClick:function(t){var i=t.target.getBoundingClientRect();e.current.resizeCover(t.clientX-i.left)}},r.a.createElement("div",{className:"cover",ref:a},r.a.createElement("canvas",{ref:s})),r.a.createElement("canvas",{className:"line",ref:c})),r.a.createElement(o.a,{type:"primary",onClick:function(){e.current.play()}},r.a.createElement(u.a,{type:"play-circle"})),r.a.createElement(o.a,{type:"primary",onClick:function(){e.current.pause()}},r.a.createElement(u.a,{type:"pause"})))};var P=function(){var t=Object(n.useState)(null),e=Object(c.a)(t,2),i=e[0],a=e[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("input",{type:"file",onChange:function(t){var e=new FileReader;if(t.target.files.length){var i=t.target.files[0];e.readAsArrayBuffer(i),e.onload=function(){a(e.result)}}}}),r.a.createElement(k,{data:i})))};s.a.render(r.a.createElement(P,null),document.getElementById("root"))},87:function(t,e,i){t.exports=i(163)}},[[87,1,2]]]);
//# sourceMappingURL=main.aa51dcab.chunk.js.map